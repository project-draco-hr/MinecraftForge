{
  boolean handled=false;
  if (msg instanceof C17PacketCustomPayload) {
    handled=handleServerSideCustomPacket((C17PacketCustomPayload)msg,ctx);
  }
 else   if (msg instanceof S3FPacketCustomPayload) {
    handled=handleClientSideCustomPacket((S3FPacketCustomPayload)msg,ctx);
  }
 else   if (msg instanceof S40PacketDisconnect && state != ConnectionState.CONNECTED) {
    completeClientSideConnection();
  }
 else   if (state != ConnectionState.CONNECTED) {
    FMLLog.info("Unexpected packet during modded negotiation - assuming vanilla or keepalives : %s",msg.getClass().getName());
  }
  if (!handled) {
    ctx.fireChannelRead(msg);
  }
}
