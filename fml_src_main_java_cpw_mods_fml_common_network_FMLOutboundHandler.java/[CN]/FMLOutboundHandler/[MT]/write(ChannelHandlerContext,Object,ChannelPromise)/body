{
  if (!(msg instanceof FMLProxyPacket)) {
    return;
  }
  FMLProxyPacket pkt=(FMLProxyPacket)msg;
  OutboundTarget outboundTarget;
  Object args=null;
  NetworkDispatcher dispatcher=ctx.channel().attr(NetworkDispatcher.FML_DISPATCHER).get();
  if (dispatcher != null) {
    ctx.write(msg,promise);
    return;
  }
  if (ctx.channel().attr(NetworkRegistry.CHANNEL_SOURCE).get() == Side.CLIENT) {
    outboundTarget=OutboundTarget.TOSERVER;
  }
 else {
    outboundTarget=ctx.channel().attr(FML_MESSAGETARGET).get();
    args=ctx.channel().attr(FML_MESSAGETARGETARGS).get();
    outboundTarget.validateArgs(args);
  }
  List<NetworkDispatcher> dispatchers=outboundTarget.selectNetworks(args,ctx,pkt);
  if (dispatchers == null) {
    ctx.write(msg,promise);
    return;
  }
  for (  NetworkDispatcher targetDispatcher : dispatchers) {
    targetDispatcher.sendProxy((FMLProxyPacket)msg);
  }
}
