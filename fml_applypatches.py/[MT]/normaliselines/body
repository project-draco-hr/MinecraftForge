def normaliselines(in_filename, out_filename=None):
    in_filename = os.path.normpath(in_filename)
    if (out_filename is None):
        tmp_filename = (in_filename + '.tmp')
    else:
        out_filename = os.path.normpath(out_filename)
        tmp_filename = out_filename
        dir_name = os.path.dirname(out_filename)
        if dir_name:
            if (not os.path.exists(dir_name)):
                os.makedirs(dir_name)
    regex_ending = re.compile('\\r?\\n')
    with open(in_filename, 'rb') as in_file:
        with open(tmp_filename, 'wb') as out_file:
            buf = in_file.read()
            if (os.linesep == '\r\n'):
                buf = regex_ending.sub('\\r\\n', buf)
            else:
                buf = buf.replace('\r\n', '\n')
            out_file.write(buf)
    if (out_filename is None):
        shutil.move(tmp_filename, in_filename)
