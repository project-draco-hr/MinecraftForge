{
  testMessageValidity(msg);
  ByteBuf payload=msg.payload().copy();
  byte discriminator=payload.readByte();
  Class<? extends A> clazz=discriminators.get(discriminator);
  if (clazz == null) {
    throw new NullPointerException("Undefined message for discriminator " + discriminator + " in channel "+ msg.channel());
  }
  A newMsg=clazz.newInstance();
  ctx.attr(INBOUNDPACKETTRACKER).get().set(new WeakReference<FMLProxyPacket>(msg));
  decodeInto(ctx,payload.slice(),newMsg);
  out.add(newMsg);
}
