{
  ByteBuf buffer=Unpooled.buffer();
  @SuppressWarnings("unchecked") Class<? extends A> clazz=(Class<? extends A>)msg.getClass();
  byte discriminator=types.get(clazz);
  buffer.writeByte(discriminator);
  encodeInto(ctx,msg,buffer);
  FMLProxyPacket proxy=new FMLProxyPacket(buffer.copy(),ctx.channel().attr(NetworkRegistry.FML_CHANNEL).get());
  FMLProxyPacket old=inboundPacket.get();
  proxy.setDispatcher(old.getDispatcher());
  out.add(proxy);
}
