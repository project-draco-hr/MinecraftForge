{
  TRSRTransformation ret=TRSRTransformation.identity();
  if (node.getParent() != null) {
    TRSRTransformation pm=cache.getUnchecked(Triple.<Animation,Node<?>,Integer>of(animation,node.getParent(),frame));
    ret=ret.compose(pm);
  }
  Key key=null;
  if (animation != null)   key=animation.getKeys().get(frame,node);
 else   if (key == null && node.getAnimation() != null && node.getAnimation() != animation)   key=node.getAnimation().getKeys().get(frame,node);
  if (key == null) {
    FMLLog.severe("invalid key index: " + frame);
  }
 else {
    ret=ret.compose(new TRSRTransformation(key.getPos(),key.getRot(),key.getScale(),null));
    Matrix4f rm=new TRSRTransformation(node.getPos(),node.getRot(),node.getScale(),null).getMatrix();
    rm.invert();
    ret=ret.compose(new TRSRTransformation(rm));
  }
  return ret;
}
