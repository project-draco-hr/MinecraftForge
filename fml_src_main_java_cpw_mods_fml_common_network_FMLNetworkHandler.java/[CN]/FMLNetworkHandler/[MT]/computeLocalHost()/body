{
  InetAddress add=null;
  List<InetAddress> addresses=Lists.newArrayList();
  InetAddress localHost=InetAddress.getLocalHost();
  for (  NetworkInterface ni : Collections.list(NetworkInterface.getNetworkInterfaces())) {
    if (!ni.isLoopback() && ni.isUp()) {
      addresses.addAll(Collections.list(ni.getInetAddresses()));
      if (addresses.contains(localHost)) {
        add=localHost;
        break;
      }
    }
  }
  if (add == null && !addresses.isEmpty()) {
    for (    InetAddress addr : addresses) {
      if (addr.getAddress().length == 4) {
        add=addr;
        break;
      }
    }
  }
  if (add == null) {
    add=localHost;
  }
  return add;
}
