{
  final PersistentRegistryManager.GameDataSnapshot snapshot=PersistentRegistryManager.takeSnapshot();
  PersistentRegistryManager.freezeData();
  ObjectHolderRegistry.INSTANCE.applyObjectHolders();
  final FMLControlledNamespacedRegistry<Block> blockRegistry=(FMLControlledNamespacedRegistry<Block>)PersistentRegistryManager.findRegistryByType(Block.class);
  Block fnd=blockRegistry.getValue(myDirt);
  assertNotEquals("Didn't find my block",fnd,testDirtBlock);
  assertEquals("Found a default air block",fnd,Blocks.AIR);
  snapshot.entries.get(PersistentRegistryManager.BLOCKS).ids.put(myDirt,218);
  PersistentRegistryManager.injectSnapshot(snapshot,true,true);
  ObjectHolderRegistry.INSTANCE.applyObjectHolders();
  fnd=blockRegistry.getValue(myDirt);
  assertNotEquals("Did not find my block",fnd,testDirtBlock);
  assertTrue("Found a dummy air block",fnd.getClass().getName().endsWith("BlockDummyAir"));
  final Set<ResourceLocation> dummied=PersistentRegistryManager.takeSnapshot().entries.get(PersistentRegistryManager.BLOCKS).dummied;
  assertTrue("Found my block in the dummy list",dummied.contains(myDirt));
  PersistentRegistryManager.revertToFrozen();
  ObjectHolderRegistry.INSTANCE.applyObjectHolders();
  fnd=blockRegistry.getValue(myDirt);
  assertNotEquals("Did not find my block",fnd,testDirtBlock);
  assertEquals("Found a default air block",fnd,Blocks.AIR);
  GameRegistry.register(testDirtBlock,myDirt);
  fnd=blockRegistry.getValue(myDirt);
  assertEquals("Found my block",fnd,testDirtBlock);
  snapshot.entries.get(PersistentRegistryManager.BLOCKS).dummied.add(myDirt);
  PersistentRegistryManager.injectSnapshot(snapshot,true,true);
  ObjectHolderRegistry.INSTANCE.applyObjectHolders();
  fnd=blockRegistry.getValue(myDirt);
  assertEquals("Found my block",fnd,testDirtBlock);
  PersistentRegistryManager.revertToFrozen();
  PersistentRegistryManager.injectSnapshot(snapshot,false,false);
  ObjectHolderRegistry.INSTANCE.applyObjectHolders();
  fnd=blockRegistry.getValue(myDirt);
  assertNotEquals("Did not find my block",fnd,testDirtBlock);
  assertTrue("Found a dummy air block",fnd.getClass().getName().endsWith("BlockDummyAir"));
}
