{
  if (tag.hasKey("ModList")) {
    NBTTagList modList=tag.getTagList("ModList",(byte)10);
    for (int i=0; i < modList.tagCount(); i++) {
      NBTTagCompound mod=modList.getCompoundTagAt(i);
      String modId=mod.getString("ModId");
      String modVersion=mod.getString("ModVersion");
      ModContainer container=Loader.instance().getIndexedModList().get(modId);
      if (container == null) {
        FMLLog.log("fml.ModTracker",Level.ERROR,"This world was saved with mod %s which appears to be missing, things may not work well",modId);
        continue;
      }
      if (!modVersion.equals(container.getVersion())) {
        FMLLog.log("fml.ModTracker",Level.INFO,"This world was saved with mod %s version %s and it is now at version %s, things may not work well",modId,modVersion,container.getVersion());
      }
    }
  }
  if (tag.hasKey("ModItemData")) {
    FMLLog.info("Attempting to convert old world data to new system. This may be trouble!");
    NBTTagList modList=tag.getTagList("ModItemData",(byte)10);
    Map<String,Integer> dataList=Maps.newLinkedHashMap();
    for (int i=0; i < modList.tagCount(); i++) {
      NBTTagCompound itemTag=modList.getCompoundTagAt(i);
      String modId=itemTag.getString("ModId");
      String itemType=itemTag.getString("ItemType");
      int itemId=itemTag.getInteger("ItemId");
      int ordinal=itemTag.getInteger("ordinal");
      String forcedModId=itemTag.hasKey("ForcedModId") ? itemTag.getString("ForcedModId") : null;
      String forcedName=itemTag.hasKey("ForcedName") ? itemTag.getString("ForcedName") : null;
      if (forcedName == null) {
        FMLLog.warning("Found unlabelled item in world save, this may cause problems. The item type %s:%d will not be present",itemType,ordinal);
      }
 else {
        boolean isItem;
        try {
          Class<?> clazz=Class.forName(itemType);
          clazz.asSubclass(Item.class);
          isItem=true;
        }
 catch (        ClassNotFoundException cnfs) {
          FMLLog.warning("The old item %s is not present in this game, it's type cannot be inferred - it will be skipped",itemType);
          continue;
        }
catch (        ClassCastException ccs) {
          isItem=false;
        }
        String itemLabel=String.format("%c%s:%s",isItem ? '\u0002' : '\u0001',forcedModId != null ? forcedModId : modId,forcedName);
        dataList.put(itemLabel,itemId);
      }
    }
    List<String> failedElements=GameData.injectWorldIDMap(dataList,true,true);
    if (!failedElements.isEmpty()) {
      throw new GameRegistryException("Failed to load the world - there are fatal block and item id issues",failedElements);
    }
  }
 else   if (tag.hasKey("ItemData")) {
    NBTTagList list=tag.getTagList("ItemData",10);
    Map<String,Integer> dataList=Maps.newLinkedHashMap();
    for (int i=0; i < list.tagCount(); i++) {
      NBTTagCompound dataTag=list.getCompoundTagAt(i);
      dataList.put(dataTag.getString("K"),dataTag.getInteger("V"));
    }
    if (!tag.hasKey("BlockedItemIds")) {
      GameData.fixBrokenIds(dataList);
    }
    int[] blockedIds=tag.getIntArray("BlockedItemIds");
    Map<String,String> blockAliases=new HashMap<String,String>();
    list=tag.getTagList("BlockAliases",10);
    for (int i=0; i < list.tagCount(); i++) {
      NBTTagCompound dataTag=list.getCompoundTagAt(i);
      blockAliases.put(dataTag.getString("K"),dataTag.getString("V"));
    }
    Map<String,String> itemAliases=new HashMap<String,String>();
    list=tag.getTagList("ItemAliases",10);
    for (int i=0; i < list.tagCount(); i++) {
      NBTTagCompound dataTag=list.getCompoundTagAt(i);
      itemAliases.put(dataTag.getString("K"),dataTag.getString("V"));
    }
    List<String> failedElements=GameData.injectWorldIDMap(dataList,blockedIds,blockAliases,itemAliases,true,true);
    if (!failedElements.isEmpty()) {
      throw new GameRegistryException("Failed to load the world - there are fatal block and item id issues",failedElements);
    }
  }
}
