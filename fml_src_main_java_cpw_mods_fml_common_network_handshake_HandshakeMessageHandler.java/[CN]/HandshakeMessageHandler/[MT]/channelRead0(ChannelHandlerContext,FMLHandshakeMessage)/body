{
  S state=ctx.attr(fmlHandshakeState).get();
  S newState=state.accept(ctx,msg);
  ctx.attr(fmlHandshakeState).set(newState);
}
