{
  FMLLog.fine("Verifying mod requirements are satisfied");
  try {
    BiMap<String,ArtifactVersion> modVersions=HashBiMap.create();
    for (    ModContainer mod : mods) {
      modVersions.put(mod.getModId(),mod.getProcessedVersion());
    }
    for (    ModContainer mod : mods) {
      Set<ArtifactVersion> missingMods=Sets.difference(mod.getRequirements(),modVersions.values());
      if (!missingMods.isEmpty()) {
        FMLLog.severe("The mod %s (%s) requires mods %s to be available",mod.getModId(),mod.getName(),missingMods);
        throw new MissingModsException(missingMods);
      }
      ImmutableList<ArtifactVersion> allDeps=ImmutableList.<ArtifactVersion>builder().addAll(mod.getDependants()).addAll(mod.getDependencies()).build();
      for (      ArtifactVersion v : allDeps) {
        missingMods=Sets.newHashSet();
        if (modVersions.containsKey(v.getLabel())) {
          if (!v.containsVersion(modVersions.get(v.getLabel()))) {
            missingMods.add(v);
          }
        }
      }
      if (!missingMods.isEmpty()) {
        FMLLog.severe("The mod %s (%s) requires mod versions %s to be available",mod.getModId(),mod.getName(),missingMods);
        throw new MissingModsException(missingMods);
      }
    }
    FMLLog.fine("All mod requirements are satisfied");
    ModSorter sorter=new ModSorter(mods,namedMods);
    try {
      FMLLog.fine("Sorting mods into an ordered list");
      mods=sorter.sort();
      FMLLog.fine("Mod sorting completed successfully");
    }
 catch (    ModSortingException sortException) {
      FMLLog.severe("A dependency cycle was detected in the input mod set so an ordering cannot be determined");
      FMLLog.severe("The visited mod list is %s",sortException.getExceptionData().getVisitedNodes());
      FMLLog.severe("The first mod in the cycle is %s",sortException.getExceptionData().getFirstBadNode());
      FMLLog.log(Level.SEVERE,sortException,"The full error");
      throw new LoaderException(sortException);
    }
  }
  finally {
    FMLLog.fine("Mod sorting data:");
    for (    ModContainer mod : mods) {
      if (!mod.isImmutable()) {
        FMLLog.fine("\t%s(%s): %s (%s)",mod.getModId(),mod.getName(),mod.getSource().getName(),mod.getSortingRules());
      }
    }
    if (mods.size() == 0) {
      FMLLog.fine("No mods found to sort");
    }
  }
}
