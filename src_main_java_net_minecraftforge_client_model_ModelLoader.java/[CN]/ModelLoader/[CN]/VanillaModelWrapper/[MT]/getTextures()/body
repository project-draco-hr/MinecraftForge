{
  if (model.getParentLocation() != null) {
    if (model.getParentLocation().getResourcePath().equals("builtin/generated")) {
      model.parent=MODEL_GENERATED;
    }
 else {
      try {
        IModel parent=getModel(model.getParentLocation());
        if (parent instanceof VanillaModelWrapper) {
          model.parent=((VanillaModelWrapper)parent).model;
        }
 else {
          throw new IllegalStateException("vanilla model '" + model + "' can't have non-vanilla parent");
        }
      }
 catch (      IOException e) {
        FMLLog.warning("Could not load vanilla model parent '" + model.getParentLocation() + "' for '"+ model+ "': "+ e.toString());
        IModel missing=ModelLoader.this.getMissingModel();
        if (missing instanceof VanillaModelWrapper) {
          model.parent=((VanillaModelWrapper)missing).model;
        }
 else {
          throw new IllegalStateException("vanilla model '" + model + "' has missing parent, and missing model is not a vanilla model");
        }
      }
    }
  }
  ImmutableSet.Builder<ResourceLocation> builder=ImmutableSet.builder();
  if (hasItemModel(model)) {
    for (    String s : (List<String>)ItemModelGenerator.LAYERS) {
      String r=model.resolveTextureName(s);
      ResourceLocation loc=new ResourceLocation(r);
      if (!r.equals(s)) {
        builder.add(loc);
      }
      if (model.getRootModel() == MODEL_COMPASS && !loc.equals(TextureMap.LOCATION_MISSING_TEXTURE)) {
        TextureAtlasSprite.setLocationNameCompass(loc.toString());
      }
 else       if (model.getRootModel() == MODEL_CLOCK && !loc.equals(TextureMap.LOCATION_MISSING_TEXTURE)) {
        TextureAtlasSprite.setLocationNameClock(loc.toString());
      }
    }
  }
  for (  String s : (Iterable<String>)model.textures.values()) {
    if (!s.startsWith("#")) {
      builder.add(new ResourceLocation(s));
    }
  }
  return builder.build();
}
