{
  if (event.getResult() != Event.Result.DEFAULT) {
    return;
  }
  if (event.current == null || !event.current.isItemEqual(empty) || (nbtSensitive && ItemStack.areItemStackTagsEqual(event.current,empty))) {
    return;
  }
  if (event.target == null || event.target.typeOfHit != MovingObjectPosition.MovingObjectType.BLOCK) {
    return;
  }
  World world=event.world;
  BlockPos pos=event.target.getBlockPos();
  IBlockState state=world.getBlockState(pos);
  if (state.getBlock() instanceof IFluidBlock) {
    IFluidBlock fluidBlock=(IFluidBlock)state.getBlock();
    if (fluidBlock.canDrain(world,pos)) {
      FluidStack drained=fluidBlock.drain(world,pos,false);
      if (drained != null && drained.amount == capacity) {
        ItemStack filledBucket=new ItemStack(this);
        int filled=this.fill(filledBucket,drained,false);
        if (filled == drained.amount) {
          drained=fluidBlock.drain(world,pos,true);
          this.fill(filledBucket,drained,true);
          event.setResult(Event.Result.ALLOW);
          event.result=filledBucket;
        }
 else {
          event.setCanceled(true);
        }
      }
    }
  }
}
