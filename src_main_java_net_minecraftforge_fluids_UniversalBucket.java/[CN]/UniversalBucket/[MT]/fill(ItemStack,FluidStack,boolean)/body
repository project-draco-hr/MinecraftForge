{
  if (container.stackSize != 1) {
    return 0;
  }
  if (resource == null || resource.amount != getCapacity()) {
    return 0;
  }
  if (!FluidRegistry.getBucketFluids().contains(resource.getFluid())) {
    return 0;
  }
  if (doFill) {
    NBTTagCompound tag=container.getTagCompound();
    if (tag == null) {
      tag=new NBTTagCompound();
    }
    resource.writeToNBT(tag);
    container.setTagCompound(tag);
  }
  return getCapacity();
}
