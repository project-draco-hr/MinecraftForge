{
  showWindow(true);
  if (minecraftApplet.getClass().getClassLoader() == classLoader) {
    if (popupWindow != null) {
      popupWindow.setVisible(false);
      popupWindow.dispose();
    }
    try {
      newApplet=minecraftApplet;
      appletClass=ReflectionHelper.getClass(classLoader,"net.minecraft.client.MinecraftApplet");
      ReflectionHelper.findMethod(appletClass,newApplet,new String[]{"fmlInitReentry"}).invoke(newApplet);
      return;
    }
 catch (    Exception e) {
      System.out.println("FMLRelauncher.relaunchApplet");
      e.printStackTrace();
      throw new RuntimeException(e);
    }
  }
  File mcDir=computeExistingClientHome();
  setupHome(mcDir);
  setupNewClientHome(mcDir);
  Class<? super Object> parentAppletClass=ReflectionHelper.getClass(getClass().getClassLoader(),"java.applet.Applet");
  try {
    appletClass=ReflectionHelper.getClass(classLoader,"net.minecraft.client.MinecraftApplet");
    newApplet=appletClass.newInstance();
    Object appletContainer=ReflectionHelper.getPrivateValue(ReflectionHelper.getClass(getClass().getClassLoader(),"java.awt.Component"),minecraftApplet,"parent");
    String launcherClassName=System.getProperty("minecraft.applet.WrapperClass","net.minecraft.Launcher");
    Class<? super Object> launcherClass=ReflectionHelper.getClass(getClass().getClassLoader(),launcherClassName);
    if (launcherClass.isInstance(appletContainer)) {
      ReflectionHelper.findMethod(ReflectionHelper.getClass(getClass().getClassLoader(),"java.awt.Container"),minecraftApplet,new String[]{"removeAll"}).invoke(appletContainer);
      ReflectionHelper.findMethod(launcherClass,appletContainer,new String[]{"replace"},parentAppletClass).invoke(appletContainer,newApplet);
    }
 else {
      FMLRelaunchLog.severe("Found unknown applet parent %s, unable to inject!\n",appletContainer.getClass().getName());
      throw new RuntimeException();
    }
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
 finally {
    if (popupWindow != null) {
      popupWindow.setVisible(false);
      popupWindow.dispose();
    }
  }
}
