{
  this.loader=loader;
  this.modList=loader.getIndexedModList();
  this.masterChannel=new EventBus("FMLMainChannel");
  this.masterChannel.register(this);
  Builder<String,EventBus> eventBus=ImmutableMap.builder();
  for (  ModContainer mod : loader.getModList()) {
    EventBus bus=new EventBus(mod.getModId());
    boolean isActive=mod.registerBus(bus,this);
    if (isActive) {
      FMLLog.fine("Activating mod %s",mod.getModId());
      activeModList.add(mod);
      modStates.put(mod.getModId(),ModState.UNLOADED);
      eventBus.put(mod.getModId(),bus);
    }
 else {
      FMLLog.warning("Mod %s has been disabled through configuration",mod.getModId());
      modStates.put(mod.getModId(),ModState.UNLOADED);
      modStates.put(mod.getModId(),ModState.DISABLED);
    }
  }
  eventChannels=eventBus.build();
  state=LoaderState.CONSTRUCTING;
}
